app-id: com.Shanu911.testqtflatpak
runtime: org.kde.Platform
runtime-version: '6.5'
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '6.5'
command: hw
finish-args:
  - "--share=ipc"
  - "--socket=wayland"
  - "--socket=fallback-x11"
  - "--socket=pulseaudio"
  - "--share=network"
  - "--device=all"
  - "--device=dri"
  - "--filesystem=host"
  - "--filesystem=xdg-download"
  - "--talk-name=org.freedesktop.Notifications"
  - "--talk-name=org.kde.StatusNotifierWatcher"
  - "--talk-name=org.kde.StatusNotifierItem"
  - "--talk-name=org.freedesktop.portal.FileChooser"
  - "--talk-name=com.canonical.AppMenu.Registrar"
  - "--talk-name=com.canonical.Unity"
  - "--talk-name=com.canonical.indicator.application"
  - "--talk-name=org.ayatana.indicator.application"
  - "--unset-env=XDG_DATA_HOME"
  - "--env=QT_PLUGIN_PATH=/app/lib64/plugins:/app/lib/plugins"
  - "--env=QTWEBENGINEPROCESS_PATH=/app/bin/QtWebEngineProcess"
  
cleanup:
  - /include
  - /lib/pkgconfig
  - '*.la'
  - '*.a'
cleanup-commands:
  - /app/cleanup-BaseApp.sh
modules:       
    # Generated by req2flatpak.py --requirements-file requirements.txt --target-platforms cp37-x86_64 --yaml
  - name: python3-package-installation
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} --no-build-isolation opencv-python-headless attrdict pyqt5
        pyqt5-qt5 pyqt5-sip pyqt5-tools
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ef/97/28fe7e68bc7adfce67d4339756e85e9fcf3c6fd7f0c0781695352b70472c/attrdict-2.0.1-py2.py3-none-any.whl
        sha256: 9432e3498c74ff7e1b20b3d93b45d766b71cbffa90923496f82c4ae38b92be34
      - type: file
        url: https://files.pythonhosted.org/packages/3f/45/21fc904365f9cea3559e0192349bfe3ea2dce52672c1d9127c3b59711804/opencv_python_headless-4.7.0.72-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl
        sha256: 18dac3147863d2f4beef6b06b784ee115799a7842e2883adc4ae750c432613f9
        only-arches:
        - x86_64
      - type: file
        url: https://files.pythonhosted.org/packages/ed/62/cd9f10702c75b242f82da858668fba0cda04cda92133244d3d1555e530b4/PyQt5-5.15.4-cp36.cp37.cp38.cp39-abi3-manylinux2014_x86_64.whl
        sha256: 883a549382fc22d29a0568f3ef20b38c8e7ab633a59498ac4eb63a3bf36d3fd3
        only-arches:
        - x86_64
      - type: file
        url: https://files.pythonhosted.org/packages/83/d4/241a6a518d0bcf0a9fcdcbad5edfed18d43e884317eab8d5230a2b27e206/PyQt5_Qt5-5.15.2-py3-none-manylinux2014_x86_64.whl
        sha256: 1988f364ec8caf87a6ee5d5a3a5210d57539988bf8e84714c7d60972692e2f4a
        only-arches:
        - x86_64
      - type: file
        url: https://files.pythonhosted.org/packages/39/5f/fd9384fdcb9cd0388088899c110838007f49f5da1dd1ef6749bfb728a5da/PyQt5_sip-12.11.0.tar.gz
        sha256: b4710fd85b57edef716cc55fae45bfd5bfac6fc7ba91036f1dcc3f331ca0eb39
      - type: file
        url: https://files.pythonhosted.org/packages/b7/70/a25aab849a5e38ae78716acde1f917a14d9d819c8600bbb8cf536781f7c5/pyqt5_tools-5.15.4.3.2-py3-none-any.whl
        sha256: ffed39e0f5185ca155acf01195bcad1d505743a02ce1e9b8128571a78e014efa

  - name: testqtflatpak
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=${FLATPAK_DEST} .
      - install -Dm644 share/icons/${FLATPAK_ID}.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - install -Dm644 share/applications/${FLATPAK_ID}.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 share/metainfo/${FLATPAK_ID}.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml
    sources:
      - type: git
        url: https://github.com/Shanu911/testqtflatpak.git
        branch: main